<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inicio de Sesión - Sistema de Gestión</title>
</head>
<body>
    <header>
        <div class="container">
        <div class="header-content">
            <div class="title-section">
            <h1>Sistema de Gestión</h1>
            </div>
        </div>
        </div>
    </header>

    <main>
    <div class="login-container">
      <div class="login-header">
        <h2>Iniciar Sesión</h2>
        <p>Ingrese sus credenciales para acceder al sistema</p>
      </div>

      <form id="login-form" method="POST">

        <div class="form-group">
          <label for="identificacion">Usuario</label>
          <input type="text" id="identificacion" name="identificacion" 
                 placeholder="Ingrese su usuario" required>
        </div>

        <div class="form-group">
          <label for="password">Contraseña</label>
          <input type="password" id="password" name="password" 
                 placeholder="Ingrese su contraseña" required>
        </div>
        
        <button type="submit" class="btn">Iniciar Sesión</button>

        <div id="error-message" style="color: red; margin-top: 10px;"></div>
      </form>
    </div>
  </main>

  <footer>
    <div class="container">
      <p>&copy; <script>document.write(new Date().getFullYear())</script> Sistema de Gestión</p>
    </div>
  </footer>

    <script>
        document.getElementById('login-form').addEventListener('submit', async (ev) => {
        ev.preventDefault();
        
        const username = document.getElementById('identificacion').value.trim();
        const password = document.getElementById('password').value;

        const res = await fetch(`https://${location.hostname}:9876/login/sql`, {
            method: 'POST',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify({ username, password })
        });

        const errorDiv = document.getElementById('error-message');
        
        if (!res.ok) {
            errorDiv.textContent = await res.text();
            return;
        }
        
        const data = await res.json();
        if (data.token) {

            console.log('Tokens guardados en entrar.html:');
            console.log('tokenSQL:', sessionStorage.getItem('tokenSQL'));
            console.log('servidor:', sessionStorage.getItem('servidor'));
            console.log('usuario:', sessionStorage.getItem('usuario'));
            
            sessionStorage.setItem('tokenSQL', data.token);
            sessionStorage.setItem('servidor', data.servidor);
            sessionStorage.setItem('usuario', data.usuario);
            window.location.href = 'inicio.html';
        } else {
            errorDiv.textContent = 'Respuesta inválida del servidor.';
        }
    });
    </script>
</body>
</html>